Введение в сетевое администрирование:  
 
СРО: Настройте локальную сеть на двух виртуальных машинах с помощью статической и динамической IP-адресации. Настройте базовый файервол на уровне iptables и обеспечьте маршрутизацию трафика.  
 
СРОП: Проведите настройку и тестирование сетевого соединения между несколькими виртуальными машинами через VirtualBox или VMware, используя VLAN. Представьте отчет с анализом конфигураций и результатами сетевых проверок (ping, traceroute).

В данной работе была проведена настройка локальной сети на двух виртуальных машинах с использованием статической и динамической IP-адресации, а также настройка базового файервола на уровне iptables для маршрутизации трафика.


    Создание виртуальных машин:
        Созданы две виртуальные машины в VirtualBox:
            Linux_Administration (Ubuntu Server 20.04)
            VM2 (Ubuntu Server 20.04)



Статическая IP-адресация для VM1:

```console
stacy@stacy-VirtualBox:~$ sudo nano /etc/netplan/01-netcfg.yaml
stacy@stacy-VirtualBox:~$ sudo netplan apply
```
Конфигурация:

```console
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: false
      addresses:
        - 192.168.1.10/24
      gateway4: 192.168.1.1
      nameservers:
        addresses:
          - 8.8.8.8
          - 8.8.4.4
```

```console
stacy@stacy-VirtualBox:~$ ip route
default via 192.168.1.1 dev enp0s3 proto static metric 100 
169.254.0.0/16 dev enp0s3 scope link metric 1000 
192.168.1.0/24 dev enp0s3 proto kernel scope link src 192.168.1.10 metric 100
```
```
192.168.1.50 — статический IP-адрес, который вы хотите назначить.
192.168.1.1 — IP вашего шлюза.
```

После внесения изменений сохраните файл и примените настройки:
```
sudo netplan apply
```

Проверьте, применились ли настройки, выполнив:
```
ip addr show enp0s3
```

Вывод в консоль при успешной настройке: 
```
stacy@stacy-VirtualBox:/etc/netplan$ ip addr show enp0s3
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:14:ab:9b brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.50/24 brd 192.168.1.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::cd77:f8e9:7b8b:afb/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```

Теперь можно использовать ping для проверки сетевого подключения между виртуальными машинами:
Узнайте IP адрес второй виртуальной машины:
```
ip addr show
```

В выводе ищите строку, где указано inet, например:
```
inet 192.168.1.51/24 brd 192.168.1.255 scope global enp0s3
```

На первой машине введиде команду:
```
ping 192.168.1.51
```

Также проверим traceroute, чтобы посмотреть маршрут пакетов между виртуальными машинами: 
```
traceroute 192.168.1.38
```

Вывод консоль: 
```
stacy@stacy-VirtualBox:~$ traceroute 192.168.1.38
traceroute to 192.168.1.38 (192.168.1.38), 64 hops max
  1   192.168.1.38  0,189ms  0,093ms  0,090ms 
```

IP-адреса виртуальных машин:

- Виртуальная машина 1: 192.168.1.50
- Виртуальная машина 2: 192.168.1.38

Все пакеты успешно доставлены (0% потерь).
Пакеты достигли адреса за один хоп.

## Настройка ibtables 
```
sudo iptables -F
sudo iptables -X
sudo iptables -t nat -F
sudo iptables -t nat -X
sudo nano /etc/sysctl.conf
sudo sysctl -p
root@stacy-VirtualBox:/home/stacy# sudo sysctl -p
net.ipv4.ip_forward = 1
sudo iptables -A INPUT -i enp0s3 -j ACCEPT  # или ваш интерфейс внешнего подключения
sudo iptables -A INPUT -i enp0s8 -j ACCEPT  # или ваш интерфейс внутреннего подключения
sudo iptables -A OUTPUT -o enp0s3 -j ACCEPT
sudo iptables -A OUTPUT -o enp0s8 -j ACCEPT
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables-save | sudo tee /etc/iptables/rules.v4
root@stacy-VirtualBox:/home/stacy# sudo iptables-save | sudo tee /etc/iptables/rules.v4
tee: /etc/iptables/rules.v4: Нет такого файла или каталога
# Generated by iptables-save v1.8.4 on Tue Oct 29 15:29:21 2024
*nat
:PREROUTING ACCEPT [20:4186]
:INPUT ACCEPT [20:4186]
:OUTPUT ACCEPT [10:5412]
:POSTROUTING ACCEPT [10:5412]
COMMIT
# Completed on Tue Oct 29 15:29:21 2024
# Generated by iptables-save v1.8.4 on Tue Oct 29 15:29:21 2024
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -i enp0s3 -j ACCEPT
-A INPUT -i enp0s8 -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o enp0s3 -j ACCEPT
-A OUTPUT -o enp0s8 -j ACCEPT
COMMIT
# Completed on Tue Oct 29 15:29:21 2024
root@stacy-VirtualBox:/home/stacy# 
```
## Вывод

Виртуальные машины были созданы в среде VirtualBox с установленной ОС Ubuntu Server 20.04. Настройка статической IP-адресации произведена на первой виртуальной машине (VM1) с использованием netplan.
Проверка соединения между виртуальными машинами была проведена с помощью команд ping и traceroute, что показало стабильное соединение с минимальными потерями и одним хопом для передачи данных.
На VM1 был настроен базовый файервол с использованием iptables. Конфигурация позволила ограничить доступ к сети и организовать маршрутизацию, установив правила, разрешающие доступ на нужных интерфейсах, и настроив сохранение правил для автоматического применения после перезагрузки.
Установлены правила для входящих и исходящих соединений, а также разрешены уже установленные соединения, обеспечивая безопасность на базовом уровне.
Все настройки были успешно протестированы. Проведенные проверки (ping, traceroute) подтвердили стабильность соединения и корректность маршрутизации пакетов, что указывает на правильность конфигураций.
Проверка работы файервола также показала, что трафик обрабатывается в соответствии с установленными правилами.
В результате работы удалось добиться успешной настройки локальной сети на двух виртуальных машинах, обеспечения их соединения и базовой защиты с помощью iptables.
